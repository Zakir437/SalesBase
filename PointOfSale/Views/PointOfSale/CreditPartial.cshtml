@model PointOfSale.ModelViews.CreditModel
<style>
    #keyboard li {
        border: 1px solid #c9ccd0;
    }
</style>
@{ 
    var validAmount = ViewBag.TotalPrice;
    if(ViewBag.TotalPrice >= ViewBag.DueAmount && ViewBag.DueAmount > 0)
    {
        validAmount = ViewBag.DueAmount;
    }
    if(ViewBag.TotalPrice >= ViewBag.AvailabelCredit && ViewBag.AvailabelCredit > 0)
    {
        validAmount = ViewBag.AvailabelCredit;
    }
}
@if (ViewBag.AvailabelCredit > 0)
 {
    <div class="editor-label"><label>Available Credit Amount :</label></div>
    <div class="editor-field" style="padding-top:6px;">
        <span>@ViewBag.AvailabelCredit</span>Tk
    </div>
 }
<div class="editor-label"><label>Total Amount :</label></div>
<div class="editor-field" style="padding-top:6px;">
    <span id="TotalAmountInCash">@ViewBag.TotalPrice</span>Tk
</div>
<div class="editor-label"><label for="Name">Amount paid :</label></div>
<div class="editor-field">
    @if (ViewBag.DueAmount > 0 || ViewBag.AvailabelCredit > 0)
     {
        @Html.EditorFor(m => m.CreditAmount, new { htmlattributes = new { @class = "k-textbox form-control", @min = 1, @max = validAmount, @validationMessage = "Please enter valid paid amount", @type = "number", style = "width:200px; display:inline" } })
     }
    else
    {
        @Html.EditorFor(m => m.CreditAmount, new { htmlattributes = new { @class = "k-textbox form-control", @min = 1, @type = "number", style = "width:200px; display:inline" } })
    }
    <span>Tk</span> <button class="btn btn-default" id="btnTotalCredit"><i class="fa fa-money" aria-hidden="true"></i></button>
    <button class="btn btn-default" id="btnBackInCredit"><i class="fa fa-arrow-circle-left"></i></button>
    @Html.ValidationMessageFor(model => model.CreditAmount, "", new { @class = "text-Danger" })
</div>
@*<div class="editor-label"><label>Return Amount :</label></div>
    <div class="editor-field" style="padding-top:6px;">
        <span id="RefundAmountInCash">0.00</span>Tk
    </div>*@
<div class="editor-field" style="padding-top:6px;">
    <ul id="keyboard" style="height:267px; width: 201px; font: 71%/1.5 Verdana;">
        <li class="clearl letter">1</li>
        <li class="letter" id="two">2</li>
        <li class="letter" id="three">3</li>
        <li class="clearl letter" id="four">4</li>
        <li class="letter">5</li>
        <li class="letter">6</li>
        <li class="clearl letter">7</li>
        <li class="letter">8</li>
        <li class="letter">9</li>
        <li class="clearl letter" style="width:194px;">0</li>
    </ul>
</div>
<script>
    var number = 0;
    var totalPaidNumber = [];

    $("#btnTotalCredit").click(function () {
        totalPaidNumber = [];
        $("#CreditAmount").val('@validAmount');
    });

    $(".letter").click(function () {
        number = $(this).text();
        totalPaidNumber.push(number);
        number = parseInt(totalPaidNumber.join(""));
        $("#CreditAmount").val(number);
    });

    String.prototype.deleteWord = function (searchTerm) {
        var str = this;
        var n = str.search(searchTerm);
        while (str.search(searchTerm) > -1) {
            n = str.search(searchTerm);
            str = str.substring(0, n) + str.substring(n + searchTerm.length, str.length);
        }
        return str;
    }

    $("#btnBackInCredit").click(function () {
        //var text = window.getSelection().toString();
        //if (text.length > 0)
        //{
        //    totalPaidNumber = [];
        //    var textBox = $("#CreditAmount").val();
        //    textBox = textBox.deleteWord(text);
        //    $("#CreditAmount").val(textBox);
        //}
        //else {
        //    totalPaidNumber.pop();
        //    if (totalPaidNumber.length > 0) {
        //        number = parseInt(totalPaidNumber.join(""));
        //        $("#CreditAmount").val(number);
        //    }
        //    else {
        //        number = null;
        //        $("#CreditAmount").val(number);
        //    }
        //}
        totalPaidNumber.pop();
        if (totalPaidNumber.length > 0) {
            number = parseInt(totalPaidNumber.join(""));
            $("#CreditAmount").val(number);
        }
        else {
            number = null;
            $("#CreditAmount").val(number);
        }
    });

    //$("#btnBackInCredit").click(function () {
    //    var el = $("#CreditAmount");
    //    var the_value = el.val();
    //    the_value = the_value.substring(0, the_value.length - 1);
    //    el.val(the_value);
    //});



    //$('body').on('click', function (e) {
    //    if ($(e.target).closest('#keyboard').length == 0) {
    //        totalPaidNumber = [];
    //    }
    //});
</script>
