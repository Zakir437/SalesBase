@model PointOfSale.Models.ViewProduct
@using System.Globalization;
<style>
    .selected {
        border: 1px solid #483c3c;
    }
</style>
@{
    ViewBag.Title = "ProductInfo";
    Layout = "~/Views/Shared/_LayoutForTemplate.cshtml";
    PointOfSale.Models.PointOfSale_DBEntities db = new PointOfSale.Models.PointOfSale_DBEntities();
    decimal importQuantity = 0;
    long totalImport = 0;
    decimal importAvg = 0;
    decimal? saleQuantity = 0;
    decimal salePriceAvg = 0;
    decimal available = 0;
    var importList = db.ImportTransactions.Where(a => a.ProductId == Model.ProductId).ToList();
    if(importList.Any())
    {
        importQuantity = importList.Sum(s => s.Quantity);
        totalImport = importList.Count();
        importAvg = importList.Sum(s => s.PeritemCost) / totalImport;
    }

    var saleList = db.PosOrderTransactions.Where(a => a.ProductId == Model.ProductId && a.Status == true).ToList();
    if(saleList.Any())
    {
        saleQuantity = saleList.Sum(a => a.Quantity);
    }
    var salePriceList = db.ProSalePrices.Where(a => a.ProductId == Model.ProductId).ToList();
    if(salePriceList.Any())
    {
        salePriceAvg = salePriceList.Sum(a => a.Price) / salePriceList.Count();
    }

    var stockProduct = db.Stocks.FirstOrDefault(a => a.ProductId == Model.ProductId);
    if(stockProduct != null)
    {
        available = stockProduct.Quantity;
    }
}
<section class="content">
    <div class="panel panel-info">
        <div class="panel-heading" style="padding-bottom:46px;">
            <div class="pull-left">
                <h4>Product Info</h4>
            </div>
            <div class="pull-right">
                <a class="btn btn-default" id="btnBack"><i class="fa fa-arrow-left"></i> Back</a>
            </div>
        </div>
        <div class="panel-body">
            <div class="col-md-6 pull-left">
                <dl class="dl-horizontal">
                    <dt>Name</dt>
                    <dd>@Model.ProductName</dd>
                    <dt>Category</dt>
                    <dd>@Model.Categorys</dd>
                    <dt>Sub Category</dt>
                    <dd>@Model.SubCategorys</dd>
                    <dt>Unit</dt>
                    <dd>@Model.Unit</dd>
                    <dt>Minimum Quantity</dt>
                    <dd>
                        @if (Model.MinimumQuantity > 0)
                        {
                            <span>@Model.MinimumQuantity</span>
                        }
                        else
                        {
                            <span>0</span>
                        }
                    </dd>
                    <dt>Points</dt>
                    <dd>
                        @if (Model.Points > 0)
                        {
                            <span>@Model.Points</span>
                        }
                        else
                        {
                            <span>0</span>
                        }
                    </dd>
                    @if (Model.IsAfterSaleService == true)
                    {
                        <dt>Service Type</dt>
                        <dd>@Model.ServiceName</dd>
                        <dt>Service Days</dt>
                        <dd>@Model.ServiceDays</dd>
                    }
                    @if (Model.Isperishable == true)
                    {
                        <dt>Expire Days</dt>
                        <dd>@Model.ExpireDays</dd>
                    }
                    <dt>Created By</dt>
                    <dd>@Model.CreatedBy</dd>
                    <dt>Created Date</dt>
                    <dd>@Convert.ToDateTime(Model.DateTime).ToString("MMM dd yyyy")</dd>
                    <dt>Cost</dt>
                    <dd>@Model.Cost.Value.ToString("C", new CultureInfo("bn-BD"))</dd>
                    <dt>Price</dt>
                    <dd>@Model.Price.Value.ToString("C", new CultureInfo("bn-BD"))</dd>
                </dl>
            </div>
            <div class="col-md-4 col-md-offset-2 pull-right">
                <dl class="dl-horizontal">
                    <dt>Import Quantity</dt>
                    <dd>@importQuantity</dd>
                    <dt>Sale Quantity</dt>
                    <dd>@saleQuantity</dd>
                    <dt>Availability</dt>
                    <dd>@available</dd>
                    <dt>Import cost avg.</dt>
                    <dd>@importAvg.ToString("N2")</dd>
                    <dt>Sale Price avg.</dt>
                    <dd>@salePriceAvg.ToString("N2")</dd>
                </dl>
            </div>
        </div>
        <hr />
        <div class="panel-body">
            <button class="btn btn-default selected" data-toggle="tooltip" title="View import transaction" id="btnImportHistory">Import</button>
            <button class="btn btn-default" data-toggle="tooltip" title="View sale transaction" id="btnSaleHistory">Sale</button>
            @*<div class="pull-right" style="max-width: 48%!important;">
                    <div class="pull-left" style="padding: 5px 10px;padding-right:5px!important;" id="show_Days_Title"></div>
                    <button class="btn btn-primary btnProductDetailsPrint pull-right" style="height:32px; display:none"><i class="fa fa-print"></i></button>
                    <button class="btn btn-primary btnPrint pull-right" style="height:32px; margin-right:5px;"><i class="fa fa-print"></i></button>
                    <div class="btn-group btn-group-devided pull-right" data-toggle="buttons" style="padding-right:5px;">
                        <div id="reportrange" class="pull-right" style="background: #fff; cursor: pointer; padding: 5px 10px; border: 1px solid #ccc; width: 100%">
                            <span></span> <b class="caret"></b>
                        </div>
                    </div>
                </div>*@
        </div>
        <div class="panel-body" style="padding:0px 15px;">
            <div id="divInfoList" style="padding-top:5px;"></div>
            @*<div class="text-center" style="margin-bottom:10px">
                    <button class="btn btn-primary" id="btnSeeMore"><i class="fa fa-arrow-down"></i> See more</button>
                </div>*@
        </div>
    </div>
</section>
<script>
    $(document).ready(function () {
        $('[data-toggle="tooltip"]').tooltip();

        $("#liForInventory").addClass('active');
        $("#liForStock").addClass('active');

        $("#divInfoList").empty();
        $("#divInfoList").append('<div class="loading_partial"></div>');
        $("#divInfoList").load('@Url.Action("ImportProductList", "Sales")?productId=' + @Model.ProductId);
    });

    $("#btnImportHistory").click(function () {
        $("#btnImportHistory").addClass("selected");
        $("#btnSaleHistory").removeClass("selected");
        $("#divInfoList").empty();
        $("#divInfoList").append('<div class="loading_partial"></div>');
        $("#divInfoList").load('@Url.Action("ImportProductList", "Sales")?productId=' + @Model.ProductId);
    });

    $("#btnSaleHistory").click(function () {
        $("#btnImportHistory").removeClass("selected");
        $("#btnSaleHistory").addClass("selected");
        $("#divInfoList").empty();
        $("#divInfoList").append('<div class="loading_partial"></div>');
        $("#divInfoList").load('@Url.Action("SaleProductList", "Sales")?productId=' + @Model.ProductId);
    });

    $("#btnBack").click(function () {
        location.reload =  window.history.back();
    });
</script>
