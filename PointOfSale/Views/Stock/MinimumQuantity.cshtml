@{
    ViewBag.Title = "MinimunQuantity";
    Layout = "~/Views/Shared/_LayoutForTemplate.cshtml";
}
<style>
    .k-input {
        height: 26px !important;
    }
</style>
@*<section class="content-header">
    <h1>
        Fulfillment
    </h1>
    <ol class="breadcrumb">
        <li><a href="/Inventory/Dashboard"><i class="fa fa-dashboard"></i> Inventory</a></li>
        <li class="active">Fulfillment</li>
    </ol>
</section>*@
<section class="content">
    <div class="panel panel-info">
        <div class="panel-heading" style="padding-bottom:46px;">
            <div class="pull-left">
                <h4 class="uppercase">Fulfillment</h4>
            </div>
        </div>
        <div class="panel-body" style="padding:0px; padding-top:15px;">
            <div class="col-md-3 col-sm-6 col-xs-12">
                <div class="info-box bg-red">
                    <span class="info-box-icon"><i class="fa fa-list-ul "></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text">Total Red Signal Products</span>
                        <span class="info-box-number">@ViewBag.RedTotal</span>
                    </div>
                    <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
            </div>
            <div class="col-md-3 col-sm-6 col-xs-12">
                <div class="info-box bg-yellow">
                    <span class="info-box-icon"><i class="fa fa-list-ul "></i></span>
                    <div class="info-box-content">
                        <span class="info-box-text">Total Yellow Signal Products</span>
                        <span class="info-box-number">@ViewBag.YellowTotal</span>
                    </div>
                    <!-- /.info-box-content -->
                </div>
                <!-- /.info-box -->
            </div>
        </div>
        <div class="panel-heading">
            <ul class="nav nav-tabs StatusTab">
                <li class="active" id="liForAll"><a href="#tab1ForAll" data-toggle="tab">All</a></li>
                <li id="liForRed"><a href="#tab2ForRed" data-toggle="tab">Red</a></li>
                <li id="liForYellow"><a href="#tab3ForYellow" data-toggle="tab">Yellow</a></li>
            </ul>
            <div class="pull-right" style="margin-top:-34px;">
                <button type="button" id="btnPrint" class="btn btn-primary" data-toggle="tooltip" title="Print"><i class="fa fa-print"></i></button>
            </div>
        </div>
        <div class="panel-body">
            <div style="margin-bottom:40px;">
                <div class="col-md-4" style="padding-left:0px;">
                    @(Html.Kendo().MultiSelect()
                            .Name("ProductMultiSelect")
                            .DataTextField("Text")
                            .DataValueField("Value")
                            .Placeholder("Type product name...")
                            .AutoBind(false)
                            .Events(e => e.Change("onChangeProduct"))
                            .HtmlAttributes(new { style = "width: 100%;" })
                            .DataSource(source =>
                            {
                                source.Read(read =>
                                {
                                    read.Action("GetProInFullFillMent", "Inventory").Data("additionalInfo"); ;
                                })
                                .ServerFiltering(true);
                            })
                    )
                    <span class="k-icon k-i-search" style="margin-top:-25px;float:right;margin-right:10px; position:relative">&nbsp;</span>
                </div>
                <div class="col-md-4">
                    @(Html.Kendo().DropDownList()
                             .Name("CategoryDropDown")
                             .DataTextField("Text")
                             .DataValueField("Value")
                             .OptionLabel("--Select category--")
                             .Filter("contains")
                             .AutoBind(false)
                             .DataSource(source =>
                             {
                                source.Read(read =>
                                {
                                    read.Action("GetCategoryInFullFillMent", "Inventory").Data("additionalInfoForCategory"); ;
                                })
                                .ServerFiltering(false);
                             })
                             .HtmlAttributes(new { style = "width:100%;" })
                            .Events(e => { e.Change("onChangeCategory"); })
                    )
                </div>
                <div class="col-md-4" style="padding-right:0px;">
                    @(Html.Kendo().DropDownList()
                            .Name("SubCategoryDropdown")
                            .HtmlAttributes(new { style = "width:100%" })
                            .OptionLabel("--Select Sub Category--")
                            .DataTextField("Text")
                            .DataValueField("Value")
                            .DataSource(source =>
                            {
                                source.Read(read =>
                                {
                                    read.Action("GetSubCategoryInFullFillMent", "Inventory")
                                        .Data("filterCategory");
                                })
                                .ServerFiltering(true);
                            })
                            .Enable(false)
                            .AutoBind(false)
                            .CascadeFrom("CategoryDropDown")
                            .Events(e =>
                            {
                                e.Change("onChangeSubCategory");
                            })
                    )
                    <script>
                        //filter sub category by category
                        function filterCategory() {
                            return {
                                tab: tab,
                                categoryId: $("#CategoryDropDown").val()
                            };
                        }
                    </script>
                </div>
            </div>
            <div class="tab-content">
                <div class="tab-pane fade in active" id="tab1ForAll">
                    <div id="div_All"></div>
                </div>
                <div id="tab2ForRed" class="tab-pane fade">
                    <div id="div_Red"></div>
                </div>
                <div id="tab3ForYellow">
                    <div id="div_Yellow"></div>
                </div>
            </div>
            <p class="text-center">
                <button class="btn btn-primary" id="btnSeeMore"><i class="fa fa-arrow-down"></i> See more</button>
            </p>
        </div>
    </div>
</section>

<script>
    var count = 10, tab = 1, selectedValue = "", categoryId = 0, subCategoryId = 0;
    var minimumQuantityPercent = '@ViewBag.MinimumQuantityPercent';
    $(document).ready(function () {
        $("#liForInventory").addClass('active');
        $("#liForFullfilment").addClass('active');

        $("#btnPrint").prop('disabled', true);

        $("#liForAll").click();
    });

    //************************product multiselect**************************

    function onChangeProduct()
    {
        selectedValue = this.value();
        clearBeforeClick();
        if (selectedValue.length > 0)
        {
            $("#btnPrint").prop('disabled', false);

            if (tab == 1)
            {
                $("#div_All").append('<div class="loading_partial"></div>');
                $("#div_All").load('/Stock/MinimumQuantityInfoList?selectedIds=' + selectedValue);
            }
            else if (tab == 2)
            {
                $("#div_Red").append('<div class="loading_partial"></div>');
                $("#div_Red").load('/Stock/MinimumQuantityInfoList?selectedIds=' + selectedValue);
            }
            else if (tab == 3)
            {
                $("#div_Yellow").append('<div class="loading_partial"></div>');
                $("#div_Yellow").load('/Stock/MinimumQuantityInfoList?selectedIds=' + selectedValue);
            }
        }
        else
        {
            if (tab == 1)
            {
                if (categoryId > 0)
                {
                    if (subCategoryId > 0)
                    {
                        $("#div_All").append('<div class="loading_partial"></div>');
                        $("#div_All").load('/Stock/MinimumQuantityInfoList?subCategoryId=' + subCategoryId);
                    }
                    else
                    {
                        $("#div_All").append('<div class="loading_partial"></div>');
                        $("#div_All").load('/Stock/MinimumQuantityInfoList?categoryId=' + categoryId);
                    }
                }
                else
                {
                    $("#liForAll").click();
                }
            }
            else if (tab == 2)
            {
                if (categoryId > 0)
                {
                    if (subCategoryId > 0)
                    {
                        $("#div_Red").append('<div class="loading_partial"></div>');
                        $("#div_Red").load('/Stock/MinimumQuantityInfoList?subCategoryId=' + subCategoryId + '&tab=' + tab);
                    }
                    else
                    {
                        $("#div_Red").append('<div class="loading_partial"></div>');
                        $("#div_Red").load('/Stock/MinimumQuantityInfoList?categoryId=' + categoryId + '&tab=' + tab);
                    }
                }
                else {
                    $("#liForRed").click();
                }
            }
            else if (tab == 3)
            {
                if (categoryId > 0) {
                    if (subCategoryId > 0)
                    {
                        $("#div_Yellow").append('<div class="loading_partial"></div>');
                        $("#div_Yellow").load('/Stock/MinimumQuantityInfoList?subCategoryId=' + subCategoryId + '&tab=' + tab);
                    }
                    else
                    {
                        $("#div_Yellow").append('<div class="loading_partial"></div>');
                        $("#div_Yellow").load('/Stock/MinimumQuantityInfoList?categoryId=' + categoryId + '&tab=' + tab);
                    }
                }
                else {
                    $("#div_Yellow").click();
                }
            }
            if (categoryId > 0)
            {
                $("#btnPrint").prop('disabled', false);
            }
            else
            {
                $("#btnPrint").prop('disabled', true);
            }
        }
    }

    function additionalInfo() {
        return {
            tab: tab,
            categoryId: categoryId,
            subCategoryId: subCategoryId,
            text: ($.trim($("#ProductMultiSelect").data("kendoMultiSelect").input.val()) == "Type product name..." ? "" : $.trim($("#ProductMultiSelect").data("kendoMultiSelect").input.val()))
        }
    }

    //*******************************category dropdown************************************

    function additionalInfoForCategory() {
        return {
            tab: tab
        }
    }

    function onChangeCategory()
    {
        subCategoryId = 0;
        categoryId = this.value();
        $("#ProductMultiSelect").data("kendoMultiSelect").value("");
        clearBeforeClick();
        if (categoryId > 0)
        {
            $("#btnPrint").prop('disabled', false);

            if (tab == 1)
            {
                $("#div_All").append('<div class="loading_partial"></div>');
                $("#div_All").load('/Stock/MinimumQuantityInfoList?categoryId=' + categoryId);
            }
            else if (tab == 2)
            {
                $("#div_Red").append('<div class="loading_partial"></div>');
                $("#div_Red").load('/Stock/MinimumQuantityInfoList?categoryId=' + categoryId + '&tab=' + tab);
            }
            else if (tab == 3)
            {
                $("#div_Yellow").append('<div class="loading_partial"></div>');
                $("#div_Yellow").load('/Stock/MinimumQuantityInfoList?categoryId=' + categoryId + '&tab=' + tab);
            }
        }
        else
        {
            categoryId = 0;
            $("#btnPrint").prop('disabled', true);

            if (tab == 1) {
                $("#liForAll").click();
            }
            else if (tab == 2) {
                $("#liForRed").click();
            }
            else if (tab == 3) {
                $("#liForYellow").click();
            }
        }
    }

    //*****************************sub category dropdown *******************************
    function onChangeSubCategory() {
        subCategoryId = this.value();
        $("#ProductMultiSelect").data("kendoMultiSelect").value("");
        clearBeforeClick();
        if (subCategoryId > 0) {

            $("#btnPrint").prop('disabled', false);

            if (tab == 1) {
                $("#div_All").append('<div class="loading_partial"></div>');
                $("#div_All").load('/Stock/MinimumQuantityInfoList?subCategoryId=' + subCategoryId);
            }
            else if (tab == 2) {
                $("#div_Red").append('<div class="loading_partial"></div>');
                $("#div_Red").load('/Stock/MinimumQuantityInfoList?subCategoryId=' + subCategoryId + '&tab=' + tab);
            }
            else if (tab == 3) {
                $("#div_Yellow").append('<div class="loading_partial"></div>');
                $("#div_Yellow").load('/Stock/MinimumQuantityInfoList?subCategoryId=' + subCategoryId + '&tab=' + tab);
            }
        }
        else
        {
            subCategoryId = 0;
            if (tab == 1) {
                $("#div_All").append('<div class="loading_partial"></div>');
                $("#div_All").load('/Stock/MinimumQuantityInfoList?categoryId=' + categoryId);
            }
            else if (tab == 2) {
                $("#div_Red").append('<div class="loading_partial"></div>');
                $("#div_Red").load('/Stock/MinimumQuantityInfoList?categoryId=' + categoryId + '&tab=' + tab);
            }
            else if (tab == 3) {
                $("#div_Yellow").append('<div class="loading_partial"></div>');
                $("#div_Yellow").load('/Stock/MinimumQuantityInfoList?categoryId=' + categoryId + '&tab=' + tab);
            }
        }
    }

    function clearBeforeClick() {
        count = 10;
        $("#div_All").empty();
        $("#div_Red").empty();
        $("#div_Yellow").empty();

        $("#ProductMultiSelect").data("kendoMultiSelect").dataSource.read();
        $("#CategoryDropDown").data("kendoDropDownList").dataSource.read();

        $("#btnSeeMore").hide();
    }

    $("#liForAll").click(function () {
        tab = 1, categoryId = 0, subCategoryId = 0;
        $("#btnPrint").prop('disabled', true);

        clearBeforeClick();
        $("#ProductMultiSelect").data("kendoMultiSelect").value("");
        $("#CategoryDropDown").data("kendoDropDownList").value("");
        @*if (@indentCount > count)
        {
            $("#btnSeeMore").show();
        }*@
        $("#div_All").append('<div class="loading_partial"></div>');
        $("#div_All").load('/Stock/MinimumQuantityInfoList?count=' + count);
    });


    $("#liForRed").click(function () {
        tab = 2, categoryId = 0, subCategoryId = 0;
        $("#btnPrint").prop('disabled', true);
        clearBeforeClick();
        $("#ProductMultiSelect").data("kendoMultiSelect").value("");
        $("#CategoryDropDown").data("kendoDropDownList").value("");
        @*if (@indentCount > count)
        {
            $("#btnSeeMore").show();
        }*@
        $("#div_Red").append('<div class="loading_partial"></div>');
        $("#div_Red").load('/Stock/MinimumQuantityInfoList?count=' + count + '&tab=' + tab);
    });

    $("#liForYellow").click(function () {
        tab = 3, categoryId = 0, subCategoryId = 0;
        $("#btnPrint").prop('disabled', true);
        clearBeforeClick();
        $("#ProductMultiSelect").data("kendoMultiSelect").value("");
        $("#CategoryDropDown").data("kendoDropDownList").value("");
        @*if (@indentCount > count)
        {
            $("#btnSeeMore").show();
        }*@
        $("#div_Yellow").append('<div class="loading_partial"></div>');
        $("#div_Yellow").load('/Stock/MinimumQuantityInfoList?count=' + count + '&tab=' + tab);
    });

    //**********************Print function **********************************************
    $("#btnPrint").click(function () {
        var data = "categoryId=" + categoryId + "?subCategoryId=" + subCategoryId + "?selectedIds=" + selectedValue + '?tab=' + tab;
        window.open('/Inventory/FullFillMentPrint?q=' + getDataEncrypted(data), '_blank');
    });

</script>


